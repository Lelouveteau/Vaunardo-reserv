<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Syst√®me de R√©servation Pok√©mon</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen p-4">

<div class="max-w-6xl mx-auto bg-white rounded-xl shadow-lg p-6">
  <h1 class="text-3xl font-bold text-center mb-6 text-purple-600">
    üéÆ Syst√®me de R√©servation Pok√©mon
  </h1>

  <div class="flex justify-center gap-4 mb-6">
    <button onclick="setMode('client')" id="btnClient"
      class="px-6 py-2 rounded-lg font-semibold bg-blue-500 text-white">
      Client
    </button>
    <button onclick="setMode('admin')" id="btnAdmin"
      class="px-6 py-2 rounded-lg font-semibold bg-gray-200">
      Administrateur
    </button>
  </div>

  <div id="clientView">
    <label class="block font-semibold mb-2">Votre pseudo</label>
    <input id="pseudoInput" class="w-full border rounded p-2 mb-4" placeholder="Pseudo">

    <p class="text-sm text-gray-600 mb-2">Choisissez jusqu'√† 2 Pok√©mon</p>
    <div id="pokemonList" class="grid md:grid-cols-3 gap-4 mb-4"></div>

    <button onclick="reservePokemon()"
      class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold">
      Confirmer la r√©servation
    </button>
  </div>

  <div id="adminView" class="hidden space-y-6">
    <div>
      <h2 class="text-xl font-bold text-purple-600 mb-2">Ajouter des Pok√©mon</h2>
      <textarea id="scanInput" class="w-full border rounded p-2 h-24"
        placeholder="Pikachu 50&#10;Dracaufeu 65"></textarea>
      <button onclick="addPokemon()"
        class="w-full mt-2 bg-purple-500 text-white py-2 rounded">
        Ajouter √† l'inventaire
      </button>
    </div>

    <div>
      <h2 class="text-xl font-bold text-purple-600 mb-2">Commandes</h2>
      <div id="ordersList" class="space-y-4"></div>
    </div>
  </div>
</div>

<script>
let mode = 'client';
let inventory = JSON.parse(localStorage.getItem('inventory') || '[]');
let orders = JSON.parse(localStorage.getItem('orders') || '[]');
let selected = [];

function save() {
  localStorage.setItem('inventory', JSON.stringify(inventory));
  localStorage.setItem('orders', JSON.stringify(orders));
}

function setMode(m) {
  mode = m;
  document.getElementById('clientView').classList.toggle('hidden', m !== 'client');
  document.getElementById('adminView').classList.toggle('hidden', m !== 'admin');
  render();
}

function render() {
  renderPokemon();
  renderOrders();
}

function renderPokemon() {
  const list = document.getElementById('pokemonList');
  list.innerHTML = '';
  inventory.filter(p => !p.reserved).forEach(p => {
    const div = document.createElement('div');
    div.className = `border p-3 rounded cursor-pointer ${selected.includes(p.id) ? 'border-blue-500 bg-blue-50' : ''}`;
    div.onclick = () => toggleSelect(p.id);
    div.innerHTML = `<b>${p.name}</b><br>Niveau ${p.level}`;
    list.appendChild(div);
  });
}

function toggleSelect(id) {
  if (selected.includes(id)) selected = selected.filter(i => i !== id);
  else if (selected.length < 2) selected.push(id);
  renderPokemon();
}

function reservePokemon() {
  const pseudo = document.getElementById('pseudoInput').value.trim();
  if (!pseudo || selected.length === 0) return alert('Pseudo et Pok√©mon requis');

  const today = new Date().toLocaleDateString('fr-FR');
  if (orders.some(o => o.pseudo === pseudo && o.date === today)) {
    return alert('D√©j√† une r√©servation aujourd‚Äôhui');
  }

  const pokemon = inventory.filter(p => selected.includes(p.id));
  pokemon.forEach(p => p.reserved = true);

  orders.push({ id: Date.now(), pseudo, pokemon, date: today, status: 'pending' });
  selected = [];
  save();
  alert('R√©servation r√©ussie');
  render();
}

function addPokemon() {
  document.getElementById('scanInput').value.split('\n').forEach(l => {
    if (!l.trim()) return;
    const [name, level = 50] = l.split(' ');
    inventory.push({ id: Date.now() + Math.random(), name, level, reserved: false });
  });
  document.getElementById('scanInput').value = '';
  save();
  render();
}

function renderOrders() {
  const list = document.getElementById('ordersList');
  list.innerHTML = '';
  orders.forEach(o => {
    const div = document.createElement('div');
    div.className = 'border rounded p-4';
    div.innerHTML = `<b>${o.pseudo}</b> (${o.status})<br>
      ${o.pokemon.map(p => `‚Ä¢ ${p.name} niv.${p.level}`).join('<br>')}
      <div class="mt-2">
        <button onclick="toggleStatus(${o.id})" class="px-3 py-1 bg-green-100 rounded mr-2">Changer statut</button>
        <button onclick="deleteOrder(${o.id})" class="px-3 py-1 bg-red-100 rounded">Supprimer</button>
      </div>`;
    list.appendChild(div);
  });
}

function toggleStatus(id) {
  const o = orders.find(o => o.id === id);
  o.status = o.status === 'pending' ? 'completed' : 'pending';
  save(); render();
}

function deleteOrder(id) {
  const o = orders.find(o => o.id === id);
  o.pokemon.forEach(p => {
    const inv = inventory.find(i => i.id === p.id);
    if (inv) inv.reserved = false;
  });
  orders = orders.filter(o => o.id !== id);
  save(); render();
}

render();
</script>

</body>
</html>
